<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css" integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous" />
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <title>signin-signup</title>
</head>

<body>
    <div class="container">
        <div class="signin-signup">
            <form id="loginForm" action="" class="sign-in-form">
                <h2 class="title">Sign in</h2>
                <div class="input-field">
                    <i class="fas fa-user"></i>
                    <input type="text" placeholder="Email" id="lemail">
                </div>
                <div class="input-field">
                    <i class="fas fa-lock"></i>
                    <input type="password" placeholder="Password" id="lpassword">
                </div>
                <button  class="btn" id="sign_btn">Sign in</button>
                <!-- <p class="social-text">Or Sign in with social platform</p>
                
                   
                    <div class="social-media"> 
                    
                        <button id="loginWithGoogle" class="social-icon"><i class="fab fa-google"></i></button>
                                            
                    </div> -->
                    
               
                <p class="account-text">Don't have an account? <a href="#" id="sign-up-btn2">Sign up</a></p>
            </form>
            <form action="" class="sign-up-form">
                <h2 class="title">Sign up</h2>
                <div class="input-field">
                    <i class="fas fa-user"></i>
                    <input type="text" placeholder="Username" id="username">
                </div>
                <div class="input-field">
                    <i class="fas fa-envelope"></i>
                    <input type="text" placeholder="Email" id="email">
                </div>
                <div class="input-field">
                    <i class="fas fa-lock"></i>
                    <input type="password" placeholder="Password" id="password">
                </div>

                <div class="input-field">
                    <i class="fas fa-lock"></i>
                    <input type="password" placeholder="Password" id="conpassword">
                </div>
                
                <button  class="btn" id="sub_btn">Sign up</button>
                <!-- <p class="social-text">Or Sign in with social platform</p> -->
                
                <!-- <div class="social-media"> 
                    
                        <button id="loginWithGoogle" class="social-icon"><i class="fab fa-google"></i></button>
                                            
                    </div> -->
                

                
                <div class="hr"></div>
                <p class="account-text">Already have an account? <a href="#" id="sign-in-btn2">Sign in</a></p>
            </form>
        </div>
        <div class="panels-container">
            <div class="panel left-panel">
                <div class="content">
                    <img src="2.png" alt="" class="image">
                    <button class="btn" id="sign-in-btn">Sign in</button>
                </div>
                
            </div>
            <div class="panel right-panel">
                <div class="content">
                    <img src="2.png" alt="" class="image">
                    <button class="btn" id="sign-up-btn">Sign up</button>
                </div>
               
            </div>
        </div>
    </div>
    <script src="app.js"></script>


<!------------------------------------------- firebase config -------------------------------------------->
 
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-app.js";
         import { getAuth, GoogleAuthProvider, signInWithRedirect, getRedirectResult, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut} from "https://www.gstatic.com/firebasejs/9.14.0/firebase-auth.js";
        import { getDatabase, set, ref, update } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-database.js";
       
       
        const firebaseConfig = {

apiKey: "AIzaSyC8nAECw_mYAY_61KMg-xgvQg-WrJlc5-4",

authDomain: "junior299-desgin.firebaseapp.com",

databaseURL: "https://junior299-desgin-default-rtdb.firebaseio.com",

projectId: "junior299-desgin",

storageBucket: "junior299-desgin.appspot.com",

messagingSenderId: "485292188827",

appId: "1:485292188827:web:514f1052178a89f4c5523e"

};

      
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
 const auth = getAuth();
 const provider = new GoogleAuthProvider(app);

        // ----------------- references-----------------//
        sub_btn.addEventListener('click',(e) => {
    
    
     
      var uname = document.getElementById('username').value;
      
      var email = document.getElementById('email').value;
      var password = document.getElementById('password').value;
      var conpassword = document.getElementById('conpassword').value;
     
      //var file = e.target.files[0];
    //var storageRef = firebase.storage().ref("idimg");
    //storageRef.put(file);
      event.preventDefault()
    
    //.............img.............//
    
    //document.querySelector(".myFile")
    
    
    
     
    
    
      //document.getElementById("select").onclick = function(e){
    
        //var input = document.createElement('input');
        //input.type= 'file';
        //input.click();
      //}
    
     //..........checkbox..............///
    
    
     
    
     
    //...........................validation......................//
        
    function passvalidation(){
    
    
    const unameValue = uname.trim();
   
    const emailValue = email.trim();
    const passwordValue = password.trim();
    const conPassValue = conpassword.trim();
    
    
    if(passwordValue !== conPassValue) {
    
      alert("Password dose not match"); 
       return 1;
      
        } 
    
      else if(passwordValue == ""){
        alert("Password can't be null"); 
       return 1;
      }
      
      else{
        
        return 2;
        }
    
    }
    
    
  
    
    
    
    
    
    
    
    function emailvalidation(){
    
    const emailValue = email.trim();
    var mailformat = /^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;
    if(emailValue.match (mailformat)){
    
    return 1;
    }
    else{
      alert("Enter correct email");
      return 2;
    }
    }
    
    
    const emx = emailvalidation();
     
    const rex=passvalidation();
        console.log(rex);
        
        console.log(emx);
        
    
    //............usercreat..........//
    
    if ((rex==2)&&(emx==1)){
      createUserWithEmailAndPassword(auth, email, password)
    
      
        .then((userCredential) => {
    
        
         
          
            const user = userCredential.user;
          
          set(ref(database, 'users/'+user.uid),{
    
              username: uname,
              
              
              email: email,
              password: password
             
            
             
    
          })
        
          alert('user created!');
          // ...
        
        })
      
        .catch((error) => {
          const errorCode = error.code;
          const errorMessage = error.message;
    
          alert(errorMessage);
        // ..
        });
    
       
      }
        
      
    
    });

//...........................References......................//
function submitForm(e) {
    e.preventDefault();
   
  
    //   enable alert
    document.querySelector(".alert").style.display = "block";
  
    //   remove the alert
    setTimeout(() => {
      document.querySelector(".alert").style.display = "none";
    }, 3000);
  
    //   reset the form
    document.getElementById("contactForm").reset();
  }
    //        google auth    ////
    
     /* loginWithGoogle.addEventListener('click',(e)=>{
              signInWithRedirect(auth, provider);
              getRedirectResult(auth)
        .then((result) => {
        // This gives you a Google Access Token. You can use it to access Google APIs.
          const credential = GoogleAuthProvider.credentialFromResult(result);
          const token = credential.accessToken;
    
          // The signed-in user info.
          const user = result.user;
        }).catch((error) => {
         // Handle Errors here.
          const errorCode = error.code;
          const errorMessage = error.message;
         // The email of the user's account used.
          const email = error.email;
          // The AuthCredential type that was used.
         const credential = GoogleAuthProvider.credentialFromError(error);
          // ...
       });
    
       });*/

// -----------------login----------------//

sign_btn.addEventListener('click',(e)=>{
   var email = document.getElementById('lemail').value;
   var password = document.getElementById('lpassword').value;
   event.preventDefault()
      signInWithEmailAndPassword(auth, email, password)
      .then((userCredential) => {
        // Signed in 
       const user = userCredential.user;
      
        var dt = new Date();
         update(ref(database, 'users/' + user.uid),{
          last_login: dt,
        })
        
         alert('User loged in!');
        
        // ...
      })
      .catch((error) => {
        const errorCode = error.code;
        const errorMessage = error.message;

        alert(errorMessage);
  });

 });
// window.location.assign("welcome.html");

//  const user = auth.currentUser;
//   firebase.auth().onAuthStateChanged((user)=>{
//      if(user){
//          location.replace("welcome.html")
//      }
//  })
 const user = auth.currentUser;
  onAuthStateChanged(auth, (user) => {
    if (user) {

        
      // User is signed in, see docs for a list of available properties
      // https://firebase.google.com/docs/reference/js/firebase.User
      const uid = user.uid;
    //window.location.assign("welcome.html");
      //bla bla bla
      // ...
    } else {
     // window.location.assign("registration.html");
      // User is signed out
     // ...
     //bla bla bla
   }
  });

 


      </script>

</body>

</html>

